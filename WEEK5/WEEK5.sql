create database week5;

CREATE TABLE DEPT (
  DEPTNO INT PRIMARY KEY,
  DNAME VARCHAR(50),
  DLOC VARCHAR(50)
);

CREATE TABLE EMPLOYEE (
  EMPNO INT PRIMARY KEY,
  ENAME VARCHAR(50),
  MGR_NO INT,
  HIREDATE DATE,
  SAL DECIMAL(10,2),
  DEPTNO INT,
  FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)
);

CREATE TABLE PROJECT (
  PNO INT PRIMARY KEY,
  PNAME VARCHAR(50),
  PLOC VARCHAR(50)
);

CREATE TABLE ASSIGNED_TO (
  EMPNO INT,
  PNO INT,
  JOB_ROLE VARCHAR(50),
  PRIMARY KEY (EMPNO, PNO),
  FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO),
  FOREIGN KEY (PNO) REFERENCES PROJECT(PNO)
);

CREATE TABLE INCENTIVES (
  EMPNO INT,
  INCENTIVE_DATE DATE,
  INCENTIVE_AMOUNT DECIMAL(10,2),
  FOREIGN KEY (EMPNO) REFERENCES EMPLOYEE(EMPNO)
);

INSERT INTO DEPT (DEPTNO, DNAME, DLOC) VALUES
(10, 'HR', 'Bengaluru'),
(20, 'Finance', 'Hyderabad'),
(30, 'Engineering', 'Mysuru'),
(40, 'Marketing', 'Chennai'),
(50, 'Operations', 'Delhi');

INSERT INTO EMPLOYEE (EMPNO, ENAME, MGR_NO, HIREDATE, SAL, DEPTNO) VALUES
(1001, 'Amit', 2001, '2020-01-15', 60000, 10),
(1002, 'Priya', 2002, '2019-03-22', 75000, 20),
(1003, 'Rahul', 2001, '2021-07-10', 80000, 30),
(1004, 'Sneha', 2003, '2022-11-05', 55000, 40),
(1005, 'Kiran', 2002, '2020-06-18', 72000, 50);

INSERT INTO PROJECT (PNO, PNAME, PLOC) VALUES
(501, 'Apollo', 'Bengaluru'),
(502, 'Zeus', 'Hyderabad'),
(503, 'Hermes', 'Mysuru'),
(504, 'Athena', 'Chennai'),
(505, 'Poseidon', 'Delhi');

INSERT INTO ASSIGNED_TO (EMPNO, PNO, JOB_ROLE) VALUES
(1001, 501, 'Analyst'),
(1002, 502, 'Accountant'),
(1003, 503, 'Developer'),
(1004, 504, 'Coordinator'),
(1005, 505, 'Supervisor');

INSERT INTO INCENTIVES (EMPNO, INCENTIVE_DATE, INCENTIVE_AMOUNT) VALUES
(1001, '2023-12-01', 5000),
(1002, '2023-11-15', 7000),
(1003, '2024-01-10', 6000),
(1004, '2024-02-20', 4500),
(1001, '2024-03-05', 3000); -- Amit received two incentives


SELECT DISTINCT A.EMPNO
FROM ASSIGNED_TO A
JOIN PROJECT P ON A.PNO = P.PNO
WHERE P.PLOC IN ('Bengaluru', 'Hyderabad', 'Mysuru');

SELECT EMPNO
FROM EMPLOYEE
WHERE EMPNO NOT IN (
  SELECT DISTINCT EMPNO FROM INCENTIVES
);

SELECT E.EMPNO, E.ENAME, E.DEPTNO, A.JOB_ROLE, D.DLOC AS DEPT_LOCATION, P.PLOC AS PROJECT_LOCATION
FROM EMPLOYEE E
JOIN DEPT D ON E.DEPTNO = D.DEPTNO
JOIN ASSIGNED_TO A ON E.EMPNO = A.EMPNO
JOIN PROJECT P ON A.PNO = P.PNO
WHERE D.DLOC = P.PLOC;